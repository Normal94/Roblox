local GatoLib = {}
local CoreGui = (gethui and gethui()) or game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

-- CONFIGURACIÓN DE ESTILO (APPLE GLASS)
local Theme = {
    Main = Color3.fromRGB(15, 20, 25),
    Accent = Color3.fromHex("#f9bb35"),
    Glass = Color3.fromRGB(255, 255, 255),
    Text = Color3.fromRGB(240, 240, 240),
    Font = Enum.Font.GothamMedium
}

-- [1. UTILIDADES DE ARCHIVOS]
function GatoLib:Download(name, url, isBase64)
    if not isfile(name) then
        local s, r = pcall(function() return game:HttpGet(url) end)
        if s and r then
            local data = r
            if isBase64 then -- Decodificador integrado
                local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
                data = string.gsub(data, '[^'..b..'=]', '')
                data = data:gsub('.', function(x)
                    if (x == '=') then return '' end
                    local r,f='',(b:find(x)-1)
                    for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
                    return r;
                end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
                    if (#x ~= 8) then return '' end
                    local c=0
                    for i=1,8 do c=c+(x:sub(i,i)=='1' and 2^(8-i) or 0) end
                    return string.char(c)
                end)
            end
            writefile(name, data)
        end
    end
end

-- [2. ANIMACIÓN DE INICIO]
function GatoLib:ShowIntro(config)
    local IntroUI = Instance.new("ScreenGui", CoreGui)
    local Frame = Instance.new("Frame", IntroUI)
    Frame.Size = UDim2.new(1, 0, 1, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
    
    local Logo = Instance.new("ImageLabel", Frame)
    Logo.Size = UDim2.new(0, 160, 0, 160)
    Logo.Position = UDim2.new(0.5, -80, 0.5, -100)
    Logo.BackgroundTransparency = 1
    Logo.Image = isfile(config.Logo) and getcustomasset(config.Logo) or ""
    Logo.ImageTransparency = 1
    
    if isfile(config.Audio) then
        local s = Instance.new("Sound", CoreGui)
        s.SoundId = getcustomasset(config.Audio)
        s:Play()
    end

    TweenService:Create(Logo, TweenInfo.new(1), {ImageTransparency = 0}):Play()
    task.wait(2.5)
    local t = TweenService:Create(Frame, TweenInfo.new(0.8), {BackgroundTransparency = 1})
    TweenService:Create(Logo, TweenInfo.new(0.5), {ImageTransparency = 1}):Play()
    t:Play()
    t.Completed:Wait()
    IntroUI:Destroy()
end

-- [3. CONSTRUCTOR DE INTERFAZ]
function GatoLib:CreateWindow(hubName)
    local Screen = Instance.new("ScreenGui", CoreGui)
    
    -- Botón de Abrir (Minimizado)
    local OpenBtn = Instance.new("TextButton", Screen)
    OpenBtn.Size = UDim2.new(0, 100, 0, 30)
    OpenBtn.Position = UDim2.new(0.5, -50, 0, 10)
    OpenBtn.Visible = false
    OpenBtn.Text = "ABRIR GATO"
    OpenBtn.BackgroundColor3 = Theme.Main
    Instance.new("UICorner", OpenBtn)

    -- Ventana Principal
    local Main = Instance.new("CanvasGroup", Screen)
    Main.Size = UDim2.new(0, 480, 0, 350)
    Main.Position = UDim2.new(0.5, -240, 0.5, -175)
    Main.BackgroundColor3 = Theme.Main
    Main.BackgroundTransparency = 0.2
    Main.GroupTransparency = 1
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 15)
    
    local Stroke = Instance.new("UIStroke", Main)
    Stroke.Color = Theme.Glass
    Stroke.Transparency = 0.8

    -- Sidebar (Submenús)
    local Sidebar = Instance.new("Frame", Main)
    Sidebar.Size = UDim2.new(0, 130, 1, -40)
    Sidebar.Position = UDim2.new(0, 10, 0, 40)
    Sidebar.BackgroundTransparency = 1

    local TabContainer = Instance.new("ScrollingFrame", Sidebar)
    TabContainer.Size = UDim2.new(1, 0, 1, -40)
    TabContainer.Position = UDim2.new(0, 0, 0, 40)
    TabContainer.BackgroundTransparency = 1
    TabContainer.ScrollBarThickness = 0
    local TabList = Instance.new("UIListLayout", TabContainer)
    TabList.Padding = UDim.new(0, 5)

    -- Buscador
    local Search = Instance.new("TextBox", Sidebar)
    Search.Size = UDim2.new(1, 0, 0, 30)
    Search.PlaceholderText = "Buscar..."
    Search.BackgroundColor3 = Color3.fromRGB(30, 35, 40)
    Search.TextColor3 = Theme.Text
    Search.Font = Theme.Font
    Search.TextSize = 12
    Instance.new("UICorner", Search)

    local PageContainer = Instance.new("Frame", Main)
    PageContainer.Size = UDim2.new(1, -160, 1, -50)
    PageContainer.Position = UDim2.new(0, 150, 0, 45)
    PageContainer.BackgroundTransparency = 1

    -- Título y Cerrar
    local Title = Instance.new("TextLabel", Main)
    Title.Text = hubName
    Title.Size = UDim2.new(0, 200, 0, 40)
    Title.Position = UDim2.new(0, 15, 0, 0)
    Title.TextColor3 = Theme.Accent
    Title.Font = Enum.Font.GothamBold
    Title.BackgroundTransparency = 1
    Title.TextXAlignment = Enum.TextXAlignment.Left

    -- Lógica de Arrastre integrada
    local dragging, dragStart, startPos
    Main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true dragStart = input.Position startPos = Main.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

    local Window = { CurrentPage = nil }

    function Window:CreateTab(name)
        local TabBtn = Instance.new("TextButton", TabContainer)
        TabBtn.Size = UDim2.new(1, 0, 0, 32)
        TabBtn.Text = name
        TabBtn.BackgroundColor3 = Theme.Glass
        TabBtn.BackgroundTransparency = 0.95
        TabBtn.TextColor3 = Color3.fromRGB(180, 180, 180)
        Instance.new("UICorner", TabBtn)

        local Page = Instance.new("ScrollingFrame", PageContainer)
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.Visible = false
        Page.BackgroundTransparency = 1
        Page.ScrollBarThickness = 2
        local PageLayout = Instance.new("UIListLayout", Page)
        PageLayout.Padding = UDim.new(0, 8)

        TabBtn.MouseButton1Click:Connect(function()
            if Window.CurrentPage then Window.CurrentPage.Visible = false end
            Page.Visible = true
            Window.CurrentPage = Page
        end)

        -- Buscador funcional por página
        Search:GetPropertyChangedSignal("Text"):Connect(function()
            local q = Search.Text:lower()
            for _, v in pairs(Page:GetChildren()) do
                if v:IsA("Frame") and v:FindFirstChild("Title") then
                    v.Visible = v.Title.Text:lower():find(q) and true or false
                end
            end
        end)

        local Elements = {}

        function Elements:CreateButton(text, cb)
            local F = Instance.new("Frame", Page)
            F.Size = UDim2.new(1, -10, 0, 35)
            F.BackgroundColor3 = Color3.fromRGB(40, 45, 50)
            F.Name = text
            Instance.new("UICorner", F)
            local T = Instance.new("TextLabel", F)
            T.Name = "Title"; T.Text = text; T.Size = UDim2.new(1, 0, 1, 0); T.TextColor3 = Theme.Text; T.BackgroundTransparency = 1
            local B = Instance.new("TextButton", F); B.Size = UDim2.new(1,0,1,0); B.BackgroundTransparency = 1; B.Text = ""
            B.MouseButton1Click:Connect(cb)
        end

        function Elements:CreateSlider(text, min, max, def, cb)
            -- Lógica de slider integrada aquí...
        end

        return Elements
    end

    -- Animación de aparición
    Main.Visible = true
    TweenService:Create(Main, TweenInfo.new(0.5), {GroupTransparency = 0}):Play()

    return Window
end

return GatoLib
